<hmtl>
<head>
<script src="../index.js"></script>
</head>
<body>


<f-select id="testselect" options="[1,2,3]" value="[2,3]" multiple></f-select>
<f-stars id="stars" value="5"></f-stars>


<div id="tests">
<FeteButton id="testbutton" label="test" style="font-family:cursive"></FeteButton>
<input type="checkbox" checked="${checked}">
<input type="text" value="${testvalue}">
<select><option>1</option><option>2</option><option>3</option></select>
<FeteEditor id="fetetexteditor" label="Text Editor" type="text" value="${testvalue}"></FeteEditor>
<FeteEditor id="fetenumbereditor" label="Number Editor" type="number" options=[1,2,3]></FeteEditor>
<FeteEditor id="feteselecteditor" label="Select Editor" type="select" options=[1,2,3] value="${selected}" multiple></FeteEditor>
<span f-foreach="[1,2,3]">${key}:${model}</span>
</div>
<div id="editor"></div>

<script>


class FeteButton extends Fete.Component {
	onClick(event) {
		console.log(event)
	}
	render(model) {
		return '<button style="${this.style}" onclick="${this.onClick}">${this.attributes.label}</button>';
	}
}
Fete.Component.register(FeteButton);
class FeteEditor extends Fete.Component {
	onChange(event) {
		const target = event.target;
		let value = target.value;
		if(this.type==="select-multiple") {
			const values = [];
			for(let option of target.selectedOptions) {
				values.push(option.value);
			}
			value = JSON.stringify(values);
		} else if(this.type==="select-one") {
			
		} else {
			const options = (target.options ? [].slice.call(target.options) : null);
			if(options && !options.some(option => option==value || option.value==value)) {
				console.log('error: ' + value + " not in " + JSON.stringify(options));
				return;
			}
		}
		this.parentElement.value = value;
	}
	render(model) {
		const result = [];
		if(this.attributes.label) {
			const label = this.h("label",{for:this.attributes.id},this.attributes.label + ":");
			result.push(label);
		}
		if(this.attributes.type==="select") {
			const options = this.attributes.options,
				select = this.h("select");
			typeof(this.attributes.multiple)==="undefined" || (select.multiple = true);
			for(let i=0;i<options.length;i++) {
				const option = options[i],
					element = this.h("option"),
					values = (Array.isArray(this.attributes.value) ? this.attributes.value : [this.attributes.value]);
				if(typeof(option)==="object") {
					element.text = option.text;
					element.value = option.value;
					if(values.some(value => value==option.value)) {
						element.selected = true;
					}
				} else {
					element.text = option;
					element.value = option;
					if(values.some(value => value==option)) {
						element.selected = true;
					}
				}
				select.options[i] = element;
			}
			select.onchange = this.onChange;
			result.push(select);
		} else {
			const input = this.h("input");
			input.options = this.attributes.options;
			input.type = this.attributes.type;
			!this.attributes.value || (input.value = this.attributes.value);
			input.onchange = this.onChange;
			result.push(input);
		}
		return result;
	}
}
Fete.Component.register(FeteEditor);

const fete = new Fete();

//document.addEventListener("change",feteListener);
const o = {checked:true,testvalue:"test value",selected:[1,3]};
document.getElementById("tests").render(o);
fete.observe(o,event => console.log(event));


</script>


<script type="module">
/*
import Fete from "../index.js";



const fete = new Fete(),
	controller = (event,model) => { 
		
	},
	buttontemplate = '<button label="${label}" style="font-style:italic">${label}</button>',
	radiogrouptemplate =`<radiogroup options="${'${options}'}" value="${'${value}'}" f-foreach="${'${JSON.parse(node.getAttribute(\'options\'))}'}" f-let="${'${{name:name || Math.random()}}'}">
		<label>${'${model.text || model.value || model}'}</label>
		<input type="radio" name="${'${name}'}" value="${'${model}'}" checked="${'${value==model}'}">
		</radiogroup>`,
	combogrouptemplate = `<select options="${'${options}'}" value="${'${values}'}" f-foreach="${'${options}'}" multiple="${'${multiple}'}">
		<optgroup f-if="${'${model.label && model.options}'}" label="${'${model.label}'}" f-foreach="${'${model.options}'}">
			<option value="${'${model.value || model}'}" selected="${'${model.selected}'}">
			${'${model.text || model.value || model}'}
			</option>
		</optgroup>
		<option f-if="${'${typeof(model.options)===\'undefined\'}'}" value="${'${model.value || model}'}" selected="${'${model.selected}'}">
		${'${model.text || model.value || model}'}
		</option>
		</select>`,
	//combobox = new ComboView({name:"g1",options:[1,{value:2,selected:true},3]}).render("#combobox"),
	//multiselect = new ComboView({name:"g1",options:[1,{value:2,selected:true},3],values:[1,3],multiple:true}).render("#multiselect"),
	//nestedselect = new ComboView({name:"g1",options:[1,{value:2,selected:true},{label:"G1",options:[3]}],multiple:true}).render("#nestedselect");
	starstemplate = '<span f-foreach="${(() => { let i=0, result = [];while(i<value) { result.push(i++) }; return result; })()}">*</span>';

class Editor {
	constructor(config={}) {
		this.attributes = {};
		this.data = config.data;
		Object.assign(this.attributes,config.attributes);
		typeof(this.attributes.type)!=="undefined" || (this.attributes.type = "text");
		typeof(this.data)!=="undefined" || (this.data = "");
	}
	onChange(event) {
		console.log(event);
	}
	render() {
		return `<span><label f-if="${this.attributes.label}">${this.attributes.label}:</label><input type="${this.attributes.type}" value="${this.data}" onchange="(function ${this.onChange})(event)"></span>`
	}
}
*/
	//fete.register("f-select",combogrouptemplate);
	//fete.register("f-button",buttontemplate);
   // fete.register("f-editor",Editor);
	//fete.register("f-stars",starstemplate);

	//fete.render({},"#tests");
	//fete.render(new Editor({type: "number"}),"#editor");
</script>



</body>
</hmtl>
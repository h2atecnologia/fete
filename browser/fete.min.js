(function(){"use strict";function a(b){return!b||typeof Object!==b||Object.getOwnPropertyNames(b).forEach(b=>{var c=obj[b];c&&"object"==typeof c&&a(c)}),Object.freeze(b)}function b(a){"A"===a.target.tagName&&a.target.host===window.location.host&&a.target.hash&&d.rtr(a,b=>{b||a.preventDefault()})}function c(a){if(a.state){const b=document.createElement("a"),c=document.getElementById(a.state.view);a.retarget=c,b.href=a.state.href;for(let e of["href","origin","host","protocol","hostname","pathname","hash","search"])a.target[e]=b[e];d.rtr(a)}}window.addEventListener("popstate",c);const d={cView:null,rndrs:new Map,imprts:{$import:function(a,b={},c={reactive:true}){const e=document.querySelector(a),f=document.createElement("span");if(!e)throw new Error("Template not found "+a);return f.innerText=e.innerHTML.replace(/<(?=[A-Za-z\/]+?\>)/g,"\\u003c").replace(/(?=[A-Za-z]+?)>/g,"\\u003e").replace(/\&gt;/g,">").replace(/\&lt;/g,"<"),d.bnd(b,f,c),"<!DOCTYPE html>"+f.innerText.replace(/\\u003c/g,"<").replace(/\\u003e/g,">")},$forEach(a,b,c=false){let d="";return a.forEach((a,c,e)=>{d+=b(a,c,e)}),(c?"<!DOCTYPE html>":"")+d}},actvt:function(a){if(!a||a._views)return a;Object.defineProperty(a,"_views",{enumerable:!1,value:new Map});const b=new Proxy(a,{set:(a,c,e)=>{return a[c]!==e&&(a[c]=e,a._views.forEach((a,e)=>{if(a[c]&&!(e.style&&"none"===e.style.display||e.parentNode&&"none"==e.parentNode.style.display)){const a=d.rndrs.get(e);if(a)for(let c of a)c(b)}})),!0},get:(a,b)=>{if(d.cView&&"string"==typeof b){const c=a._views.get(d.cView)||{};c[b]=!0,a._views.set(d.cView,c)}return a[b]}});return b},cmpl:function(a,b={reactive:true}){!b.reset||d.rndrs.delete(a);let c=d.rndrs.get(a);if(c)return c;if(c=[],d.rndrs.set(a,c),b.template){const c=a.model;if(b.template instanceof HTMLElement)a.innerHTML=b.template.innerHTML;else if(0===b.template.indexOf("`")&&b.template.lastIndexOf("`")===b.template.length-1)a.innerHTML=b.template.substring(1,b.template.length-1);else{let c=document.querySelector(b.template);if(!c)throw new Error("missing template "+b.template);a.innerHTML=c.innerHTML}a.model=c}const e=a.childNodes;for(let f=0;f<e.length;f++){let c=e[f];c.controller=a.controller,c.ftLstnrs||(c.ftLstnrs=new Set);c.ftLstnrs;c.ftLstnrs.forEach(a=>{for(let b of["change","keyup","paste","cut"])c.removeEventListener(b,a)}),c.ftLstnrs.clear(),c instanceof Text||d.cmpl(c,{reactive:b.reactive,reset:b.reset});const g=[],h=[];if(d.rndrs.set(c,g),c.attributes)for(let i=0;i<c.attributes.length;i++)h.push(c.attributes[i].name);c instanceof Text&&h.push("wholeText");for(let j of h){const e="string"==typeof c?c:(c.getAttribute?c.getAttribute(j):c[j])||c[j],f=typeof e;if("string"===f&&e.indexOf("${")>=0){let f=e.substring(2,e.lastIndexOf("}"));1===f.split(" ").length||(f=void 0),g.push(g=>{c.model&&c.model!=g&&c.model._views.delete(c),c.model=g;const h=d.interpolator(e,c,g,j,f);if(h!==c&&(c.ftLstnrs.forEach(a=>{for(let b of["change","keyup","paste","cut"])c.removeEventListener(b,a)}),c.ftLstnrs.clear(),d.cmpl(h,{reactive:b.reactive,reset:b.reset}),c=h,c.ftLstnrs=new Set),f&&(b.reactive||a.getAttribute("data-reactive"))){const a=a=>{if("checkbox"===a.target.type)g[f]=a.target.checked;else if("select-multiple"===a.target.type){const b=[];for(let c=0;a.target[c];c++)a.target[c].selected&&b.push(a.target[c].value);g[f]=b}else g[f]=a.target.value;a.target.model=g,d.rtr(a)};if(c.ftLstnrs.add(a),c.addEventListener("change",a),("INPUT"===c.tagName||"TEXTAREA"===c.tagName)&&!["button","radio","checkbox"].includes(c.type))for(let b of["keyup","paste","cut"])c.addEventListener(b,a)}})}}}},interpolator:function(a,b,c,e,f){let g=d.cView=b;const h=new Function("doit","let __val__=''; with(this) { try { __val__ = `"+a+"` }catch(e) { if(e instanceof ReferenceError) {this[e.message.trim().replace(/'/g,'').split(' ')[0]] = '';return doit.call(this,doit); }}} return __val__;"),i=c?c:{};for(let e in d.imprts)Object.defineProperty(i,e,{enumerable:!1,configurable:!0,writable:!1,value:d.imprts[e]});const j=h.call(i,h);for(let e in d.imprts)delete i[e];if("radio"===b.type&&f)"checked"===e&&b.checked&&(b[e]=i[f]=b.value);else if("checkbox"===b.type&&f)"checked"===e&&(b[e]=i[f]="on"===j||"true"===j||!1);else if("select-one"===b.type&&f)i[f]=b.value;else if("select-multiple"===b.type&&f)i[f]||(i[f]=[]);else if("textarea"===b.type&&f)b[e]=i[f]=b.value;else if("wholeText"===e){let a;0===j.trim().toLowerCase().indexOf("<!doctype html>")?(a=document.createElement("span"),a.innerHTML=j.trim().substring(15)):a=document.createTextNode(j),b.parentNode.replaceChild(a,b),a.model=c,g=a}else b[e]===j||(b[e]=j);return d.cView=null,g},rndr:function(a,b,c){const e=a.childNodes;for(let f=0;f<e.length;f++)d.rndr(e[f],b,c);a.model=b;const g=d.rndrs.get(a);if(g)for(let h of g)h(b)},bnd:function(a,c,e,f={reactive:true}){if("object"==typeof c||(c=document.querySelector(c)),!c)throw new Error("F.bnd: 'view' undefined");return d.rndrs.delete(c),c.controller=e,c.addEventListener("click",b,!1),a=d.actvt(a),d.cmpl(c,f),d.rndr(c,a,{reactive:f.reactive}),a},rtr:function(b,c){const d=b.retarget||b.target,e=d.controller,f=d.model?JSON.parse(JSON.stringify(d.model)):{};a(f),!e||Object.keys(e).every(a=>{let c,g=e[a].test,h=!1;if(d.hash?c=d.hash.substring(1):"function"==typeof g&&(h=g(b,f)),h||c&&new RegExp(a).test(c)){d.id||(d.id=(Math.random()+"").substring(2)),"popstate"===b.type||h||history.pushState({href:d.href,view:d.id},e[a].title||c);const g=e[a].selector?document.querySelector(e[a].selector):d;return"function"==typeof e[a].sideffect&&e[a].sideffect(b,g,f),e[a].cascade}return!0}),b.preventDefault(),b.stopPropagation(),!c||c()}},e={activate:d.actvt,bind:d.bnd,imports:d.imprts};"undefined"!=typeof module?module.export=e:this.Fete=e}).call(this);